<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Apply - Gold Loan</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">

    <link href="style.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>



    <!-- jQuery (needed for ajax and $ selector) -->

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

</head>

<body>



<!--------------------------NAVBAR---------------------------------------------------->

<nav class="navbar navbar-expand-lg sticky-top custom-navbar">

    <div class="container-fluid">

        <!-- Logo + Brand -->

        <a class="navbar-brand d-flex align-items-center" href="#">

            <img class="logo-img" src="../images/logo.jpg" alt="logo">

            <span class="brand-text ms-2">Bank Loan</span>

        </a>



        <!-- Toggle for mobile -->

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu"

                aria-controls="navbarMenu" aria-expanded="false" aria-label="Toggle navigation">

            <span class="navbar-toggler-icon"></span>

        </button>



        <!-- Links -->

        <div class="collapse navbar-collapse justify-content-end" id="navbarMenu">

            <div class="navbar-buttons">

                <a href="../static/Customer/login.html" class="login-btn">Login/Register</a>

            </div>

        </div>

    </div>

</nav>





<!-- Loan Apply Form -->

<section class="apply-section py-5">

    <div class="container">

        <h2 class="text-center mb-4">Apply for Gold Loan</h2>



        <div class="loan-details mb-4 p-3 bg-light rounded shadow-sm">

            <p><strong>Interest Rate:</strong> 9.25% per annum</p>

            <p><strong>Maximum Tenure:</strong> 60 months</p>

        </div>



        <form id="loanForm" class="apply-form shadow p-4 rounded bg-white">

            <!--            <input type="hidden" id="productId" name="productId">-->



            <div class="mb-3">

                <label class="form-label">Full Name</label>

                <input type="text" id="name" class="form-control" placeholder="Enter your full name" required>

            </div>

            <div class="mb-3">

                <label class="form-label">Email Address</label>

                <input type="email" id="email" class="form-control" placeholder="Enter your email" required>

            </div>

            <div class="mb-3">

                <label class="form-label">Phone Number</label>

                <input type="tel" id="phoneNumber" class="form-control" placeholder="Enter your phone number" required>

            </div>

            <div class="mb-3">
                <!-- The 'for' attribute links the label to the select element -->
                <label for="loanType" class="form-label">Loan Type</label>

                <!-- Use a select dropdown to ensure valid loan types are chosen -->
                <select id="loanType"  class="form-control" required>
                    <option value="" disabled selected>-- Select a loan type --</option>
                    <option value="Gold">Gold Loan</option>
                </select>
            </div>


            <div class="mb-3">

                <label class="form-label">Loan Amount</label>

                <input type="number" id="loanAmount" class="form-control" placeholder="Enter desired loan amount" required>

            </div>

            <div class="mb-3">

                <label class="form-label">Preferred Tenure (Months)</label>

                <input type="number" id="tenure" class="form-control" placeholder="Up to 60 months" required>

            </div>

            <button type="submit" class="btn btn-primary w-100">Submit Application</button>

        </form>

    </div>

</section>



<!--------------------------FOOTER---------------------------------------------------->

<footer class="footer">

    <div class="footer-container">



        <!-- Social Icons -->

        <div class="social-icons">

            <a href="https://facebook.com"><i class="fab fa-facebook-f"></i></a>

            <a href="https://twitter.com"><i class="fab fa-twitter"></i></a>

            <a href="https://instagram.com"><i class="fab fa-instagram"></i></a>

            <a href="https://linkedin.com"><i class="fab fa-linkedin-in"></i></a>

        </div>



        <!-- About Us -->

        <div class="footer-section">

            <h4>About Us</h4>

            <p>

                We provide secure and efficient loan management services tailored to meet customer needs.

                Our mission is to simplify the loan process and ensure transparency.

            </p>

        </div>



        <!-- Contact Us -->

        <div class="footer-section">

            <h4>Contact Us</h4>

            <p>Email: support@loanbank.com</p>

            <p>Phone: +91-9876543210</p>

            <p>Address: 123 Finance Street, Chennai, TN</p>

        </div>

    </div>



    <div class="footer-bottom">

        &copy; 2025 All rights reserved.

    </div>

</footer>



<script>
    function checkLoginStatus() {
        const email = localStorage.getItem("loggedInEmail");
        if (email) {
            const savedUserData = localStorage.getItem("loggedInCustomer");
            if (savedUserData) {
                const userData = JSON.parse(savedUserData);
                updateNavbar(userData);
            } else {
                getUserData(email);
            }
        } else {
            // Not logged in - redirect to login
            alert("Please log in to apply for a loan.");
            window.location.href = "../Customer/login.html";
        }
    }
    function getUserData(email) {
        $.ajax({
            url: "http://localhost:8089/api/customers/email/" + email,
            method: "GET",
            success: function(data) {
                localStorage.setItem("loggedInCustomer", JSON.stringify(data));
                updateNavbar(data);
            },
            error: function() {
                alert("Could not load user data");
            }
        });
    }
    function updateNavbar(userData) {
        const navbarButtons = document.querySelector('.navbar-buttons');
        if (navbarButtons) {
            navbarButtons.innerHTML = '';
            const profileDropdownWrapper = document.createElement("div");
            profileDropdownWrapper.className = "profile-dropdown d-inline-block";
            profileDropdownWrapper.innerHTML = `
                <button class="btn btn-secondary dropdown-toggle profile-button" type="button" id="profileDropdownBtn" data-bs-toggle="dropdown" aria-expanded="false">
                    ${userData.name.split(' ')[0]}
                </button>
                <ul class="dropdown-menu" id="profileDropdown" aria-labelledby="profileDropdownBtn">
                    <li><a class="dropdown-item" href="../Customer/profile.html">Profile</a></li>
                    <li><a class="dropdown-item" href="#" id="logoutLink">Logout</a></li>
                </ul>
            `;
            navbarButtons.appendChild(profileDropdownWrapper);
            // Add logout event
            const logoutLink = document.getElementById('logoutLink');
            if (logoutLink) {
                logoutLink.addEventListener('click', logout);
            }
        }
    }
    function logout(e) {
        if (e) e.preventDefault();
        if (confirm("Are you sure you want to logout?")) {
            localStorage.removeItem("loggedInCustomer");
            localStorage.removeItem("loggedInEmail");
            window.location.href = "../Customer/login.html";
        }
    }
    $(document).ready(function() {
    checkLoginStatus();
    $('#loanForm').on('submit', function(e) {

        e.preventDefault();

        // Get form values
        const name = $('#name').val().trim();
        const email = $('#email').val().trim();
        const phoneNumber = $('#phoneNumber').val().trim();
        const loanType = $('#loanType').val();
        const loanAmount = parseFloat($('#loanAmount').val());
        const tenure = parseInt($('#tenure').val());
        const productId = 3; // Gold loan product ID

        // Validation
        if (!name || !email || !phoneNumber || !loanType || isNaN(loanAmount) || isNaN(tenure)) {
            alert("Please fill in all fields correctly.");
            return;
        }

        if (loanAmount < 100000 || loanAmount > 2000000) {
            alert ("Loan amount must be between ₹1,00,000 and ₹20,00,000.");
            return;
        }

        if (tenure <= 0 || tenure > 60) {
            alert ("Tenure must be between 1 and 60 months.");
            return;
        }

        // First AJAX call - Get customer ID by email
        $.ajax({
            url: '/api/application/getId',
            type: 'GET',
            data: { email: email },
            success: function(customerId) {
                applyForLoan(customerId, productId, loanAmount, tenure);
            },
            error: function(xhr) {
                if (xhr.status === 404) {
                    alert("Customer not found. Please register first.");
                } else {
                    alert("Error retrieving customer information. Please try again.");
                }
            }
        });
    });

    // Function to handle loan application
    function applyForLoan(customerId, productId, loanAmount, tenure) {
        $.ajax({
            url: '/api/application/applyLoan',
            type: 'POST',
            data: {
                customerId: customerId,
                productId: productId,
                loanAmount: loanAmount,
                tenure: tenure
            },
            success: function(response) {
                alert("Loan application submitted successfully!");
            },
            error: function(xhr) {
                alert("Failed to submit loan application. Please try again.");
            }
        });
    }
});







</script>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>